strip.text = element_text(size = 15))
# Visualize both plots together.
grid.arrange(p1, p2, ncol = 1)
# Define list of cell types for each subgroups.
AT2 = WhichCells(seurat_obj, idents = c("AT2"))
fibroblasts = WhichCells(seurat_obj, idents = c("Fibroblasts"))
endothelial = WhichCells(seurat_obj, idents = c("Endothelial cells"))
# Visualize the global cell proportion as a UMAP.
p1 <- DimPlot(seurat_obj,
reduction = "umap",
group.by = "cell_type",
split.by = "comparison_var",
cells.highlight = list(AT2,
fibroblasts,
endothelial),
cols.highlight = c("#808000", "#ff4500", "#00bfff"),
label = TRUE,
label.size = 3,
label.color = "#02066f",
repel = TRUE,
order = TRUE,
ncol = 3,
raster = FALSE) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 8),
axis.text.y = element_text(size = 8),
strip.text = element_text(size = 15)) +
NoLegend()
# Visualize cell proportion counts as barplot.
p2 <- celltype_timepoint_counts_mice %>%
dplyr::filter(cell_type %in% c("AT2",
"Fibroblasts",
"Endothelial cells")) %>%
group_by(cell_type, comparison_var) %>%
summarise(n = n(),
mean = plyr::round_any(mean(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
sd = plyr::round_any(sd(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
.groups = "drop") %>%
mutate(se = plyr::round_any(sd/sqrt(n), accuracy = 0.01, f = ceiling)) %>%
ggplot(aes(x = cell_type,
y = mean,
fill = cell_type)) +
geom_col(show.legend = FALSE) +
geom_errorbar(aes(ymin = mean-se,
ymax = mean+se),
width = 0.4,
alpha = 0.9) +
geom_text(aes(label = mean,
vjust = 0.5,
hjust = -0.8),
size = 5,
angle = 90) +
facet_wrap(~comparison_var, ncol = 3) +
labs(x = "Cell type",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 100) +
scale_fill_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 45,
hjust = 1,
vjust = 1),
strip.text = element_text(size = 15))
# Visualize both plots together.
grid.arrange(p1, p2, ncol = 1)
# Visualize the expressions of all cell type clusters.
VlnPlot(seurat_obj,
features = c("Acta2", "Col1a2", "Col3a1", "Col1a1", "Antxr1"),
group.by = "cell_type",
split.by = "treatment",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1,
raster = FALSE) +
theme(legend.position = "top") +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
knitr::opts_chunk$set(echo = TRUE)
# Expression pattern per cell type.
VlnPlot(seurat_obj,
features = c("Rnf214"),
group.by = "cell_type",
split.by = "treatment",
split.plot = FALSE,
flip = TRUE,
raster = FALSE) +
theme(legend.position = "top") +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Expression pattern per treatment.
DotPlot(seurat_obj,
features = "Rnf214",
group.by = "treatment",
cols = c("#440154ff", "#fde725ff"))
# Expression pattern per cell type.
VlnPlot(seurat_obj,
features = c("Rnf214"),
group.by = "cell_type",
split.by = "treatment",
split.plot = FALSE,
flip = TRUE,
raster = FALSE) +
theme(legend.position = "top") +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Expression pattern per treatment.
DotPlot(seurat_obj,
features = "Rnf214",
group.by = "treatment",
cols = c("#440154ff", "#fde725ff"))
knitr::opts_chunk$set(echo = TRUE)
library(GEOquery)
library(crayon)
library(tidyverse)
library(Seurat)
library(SeuratData)
library(Azimuth)
library(patchwork)
library(Matrix)
library(RCurl)
library(DoubletFinder)
library(scales)
library(SoupX)
library(cowplot)
library(metap)
library(SingleCellExperiment)
library(DropletUtils)
library(AnnotationHub)
library(HGNChelper)
library(ensembldb)
library(multtest)
library(glmGamPoi)
library(pbapply)
library(data.table)
library(ggrepel)
library(ggpubr)
library(stringr)
library(canvasXpress)
library(clinfun)
library(GGally)
library(gridExtra)
library(factoextra)
library(DESeq2)
library(EnhancedVolcano)
library(ComplexHeatmap)
library(limma)
library(fgsea)
library(org.Mm.eg.db)
library(kableExtra)
# Specify project file path.
project_path = "~/Documents/Work/UnityHealth/Data_Projects/scRNAseq_LungFibrosisAnalysis/GSE264162/"
# Load pre-processed Seurat objects.
load(file = paste0(project_path, "data/preprocessed_seurat_obj.RData"))
# Set colour palette for cell type.
celltype_col = c("AT1" = "#2f4f4f",
"AT2" = "#00bfff",
"Basal resting" = "#2e8b57",
"Club (non-nasal)" = "#8b008b",
"Deuterosomal" = "#00ff00",
"Endothelial cells" = "#808000",
"Endothelial lympathic" = "#00008b",
"Fibroblasts" = "#ff4500",
"Fibromyocytes" = "#ffa500",
"Immune" = "#f08080",
"Ionocyte" = "#f0e68c",
"Multiciliated (non-nasal)" = "#ff00ff",
"Myofibroblasts" = "#c71585",
"Neuroendocrine" = "#00fa9a",
"Pericytes" = "#ff1493",
"Suprabasal" = "#eee8aa",
"Transitional Club-AT2" = "#9370db",
"VSMCs" = "#00ffff")
# Set new name for Seurat object to be more informative.
seurat_obj = seurat_cluster
# Collapse different types of endothelial cells into generic endothelial cells.
grep("Endothelial", seurat_obj$cell_type, value = TRUE) %>% unique()
seurat_obj$cell_type <- gsub("Endothelial venous|Endothelial capillary|Endothelial arterial",
"Endothelial cells",
seurat_obj$cell_type)
# Collapse fibroblasts and myofibroblasts into fibroblasts.
grep("ibroblast", seurat_obj$cell_type, value = TRUE) %>% unique()
seurat_obj$cell_type <- gsub("Myofibroblasts",
"Fibroblasts",
seurat_obj$cell_type)
# Set Seurat object idents.
Idents(seurat_obj) <- "cell_type"
# Set max overlaps to infinity globally.
options(ggrepel.max.overlaps = Inf)
# Remove unneeded objects.
rm(seurat_cluster)
# Get the variables of interest.
summary_table <- (FetchData(seurat_obj,
vars = c("mice_id",
"comparison_var",
"treatment",
"age",
"timepoint",
"cell_type",
"Antxr1")))
# Each timepoint contains unsorted lung tissues from 5 mice.
# Define ANTXR1 expression based on 0 expression threshold.
summary_table <- summary_table %>% mutate(Antxr1_expressed = Antxr1 > 0)
# Calculate total cells per timepoint.
total_cells_timepoint_mice <- (summary_table %>%
group_by(mice_id, comparison_var) %>%
summarise(total_cells_timepoint = n(),
.groups = "drop"))
# Summarise cell counts per mice per timepoint for each cell type.
celltype_timepoint_counts_mice <- (summary_table %>%
group_by(mice_id, cell_type, comparison_var) %>%
summarise(celltype_count = n(),
Antxr1_total_exprs = sum(Antxr1_expressed),
.groups = "drop") %>%
left_join(total_cells_timepoint_mice,
by = c("mice_id", "comparison_var")))
# Calculate percentages.
celltype_timepoint_counts_mice <- (celltype_timepoint_counts_mice %>%
mutate(celltype_by_totalcells =
(celltype_count/total_cells_timepoint)*100,
Antxr1_by_totalcells =
(Antxr1_total_exprs/total_cells_timepoint)*100,
Antxr1_by_celltypes =
(Antxr1_total_exprs/celltype_count)*100))
# Calculate summary statistics for the calculated percentages by mice.
summary_stats <- (celltype_timepoint_counts_mice %>%
group_by(cell_type, comparison_var) %>%
summarise(
mean_percent_celltype = mean(celltype_by_totalcells),
sd_percent_celltype = sd(celltype_by_totalcells),
mean_percent_antxr1_total = mean(Antxr1_by_totalcells),
sd_percent_antxr1_total = sd(Antxr1_by_totalcells),
mean_percent_antxr1_celltype = mean(Antxr1_by_celltypes),
sd_percent_antxr1_celltype = sd(Antxr1_by_celltypes),
n_mice = n(),
se_percent_celltype = sd_percent_celltype / sqrt(n_mice),
se_percent_antxr1_total = sd_percent_antxr1_total / sqrt(n_mice),
se_percent_antxr1_celltype = sd_percent_antxr1_celltype / sqrt(n_mice),
.groups = "drop"
))
# Remove unneeded objects.
rm(total_cells_timepoint_mice)
# Visualize the global cell proportion as a UMAP.
p1 <- DimPlot(seurat_obj,
reduction = "umap",
group.by = "cell_type",
split.by = "comparison_var",
cols = celltype_col,
label = TRUE,
label.size = 3,
label.color = "#02066f",
repel = TRUE,
order = TRUE,
ncol = 3,
raster = FALSE) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 8),
axis.text.y = element_text(size = 8),
strip.text = element_text(size = 15)) +
NoLegend()
# Visualize cell proportion counts as barplot.
p2 <- celltype_timepoint_counts_mice %>%
group_by(cell_type, comparison_var) %>%
summarise(n = n(),
mean = plyr::round_any(mean(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
sd = plyr::round_any(sd(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
.groups = "drop") %>%
mutate(se = plyr::round_any(sd/sqrt(n), accuracy = 0.01, f = ceiling)) %>%
ggplot(aes(x = cell_type,
y = mean,
fill = cell_type)) +
geom_col(show.legend = FALSE) +
geom_errorbar(aes(ymin = mean-se,
ymax = mean+se),
width = 0.4,
alpha = 0.9) +
geom_text(aes(label = mean,
vjust = 0.5,
hjust = -0.8),
size = 5,
angle = 90) +
facet_wrap(~comparison_var, ncol = 3) +
labs(x = "Cell type",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 100) +
scale_fill_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 90,
hjust = 1,
vjust = 0.5),
strip.text = element_text(size = 15))
# Visualize both plots together.
grid.arrange(p1, p2, ncol = 1)
# Define list of cell types for each subgroups.
AT2 = WhichCells(seurat_obj, idents = c("AT2"))
fibroblasts = WhichCells(seurat_obj, idents = c("Fibroblasts"))
endothelial = WhichCells(seurat_obj, idents = c("Endothelial cells"))
# Visualize the global cell proportion as a UMAP.
p1 <- DimPlot(seurat_obj,
reduction = "umap",
group.by = "cell_type",
split.by = "comparison_var",
cells.highlight = list(AT2,
fibroblasts,
endothelial),
cols.highlight = c("#808000", "#ff4500", "#00bfff"),
label = TRUE,
label.size = 3,
label.color = "#02066f",
repel = TRUE,
order = TRUE,
ncol = 3,
raster = FALSE) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 8),
axis.text.y = element_text(size = 8),
strip.text = element_text(size = 15)) +
NoLegend()
# Visualize cell proportion counts as barplot.
p2 <- celltype_timepoint_counts_mice %>%
dplyr::filter(cell_type %in% c("AT2",
"Fibroblasts",
"Endothelial cells")) %>%
group_by(cell_type, comparison_var) %>%
summarise(n = n(),
mean = plyr::round_any(mean(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
sd = plyr::round_any(sd(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
.groups = "drop") %>%
mutate(se = plyr::round_any(sd/sqrt(n), accuracy = 0.01, f = ceiling)) %>%
ggplot(aes(x = cell_type,
y = mean,
fill = cell_type)) +
geom_col(show.legend = FALSE) +
geom_errorbar(aes(ymin = mean-se,
ymax = mean+se),
width = 0.4,
alpha = 0.9) +
geom_text(aes(label = mean,
vjust = 0.5,
hjust = -0.8),
size = 5,
angle = 90) +
facet_wrap(~comparison_var, ncol = 3) +
labs(x = "Cell type",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 100) +
scale_fill_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 45,
hjust = 1,
vjust = 1),
strip.text = element_text(size = 15))
# Visualize both plots together.
grid.arrange(p1, p2, ncol = 1)
View(seurat_obj@meta.data)
unique(seurat_obj$age)
knitr::opts_chunk$set(echo = TRUE)
library(GEOquery)
library(crayon)
library(tidyverse)
library(Seurat)
library(SeuratData)
library(Azimuth)
library(patchwork)
library(Matrix)
library(RCurl)
library(DoubletFinder)
library(scales)
library(SoupX)
library(cowplot)
library(metap)
library(SingleCellExperiment)
library(DropletUtils)
library(AnnotationHub)
library(HGNChelper)
library(ensembldb)
library(multtest)
library(glmGamPoi)
library(pbapply)
library(data.table)
library(ggrepel)
library(ggpubr)
library(stringr)
library(canvasXpress)
library(clinfun)
library(GGally)
library(factoextra)
library(DESeq2)
library(limma)
library(fgsea)
library(org.Mm.eg.db)
library(kableExtra)
# Specify path to supplementary files.
supp_file_path = "~/Documents/Work/UnityHealth/Data_Projects/scRNAseq_LungFibrosisAnalysis/GSE136831/"
# Get unique sample names.
sample_names = list.files(path = paste0(supp_file_path, "raw_data"), pattern = "GSM", full.names = FALSE)
sample_names
knitr::opts_chunk$set(echo = TRUE)
library(GEOquery)
library(crayon)
library(tidyverse)
library(limma)
library(pbapply)
# Pull GEO supplementary data and extract.
GEO_supp_ID <- toupper(readline(prompt = red("Enter GEO Accession to pull supplementary data: ")))
if (!dir.exists(paste0("./raw_data/", GEO_supp_ID))){
getGEOSuppFiles(GEO_supp_ID,
baseDir = "./raw_data",
fetch_files = TRUE)
untar(list.files(path = paste0("./raw_data/", GEO_supp_ID),
pattern = ".tar",
full.names = TRUE),
exdir = paste0("./raw_data/", GEO_supp_ID))
file.remove(list.files(path = paste0("./raw_data/", GEO_supp_ID),
pattern = ".tar$",
full.names = TRUE))
sapply(list.files(path = paste0("./raw_data/", GEO_supp_ID),
pattern = ".gz$",
full.names = TRUE), gunzip)
}
# Pull data based on GEO Accession.
geo_datasets <- c("GSE136831")
lupus_nephritis_datasets <- pbsapply(geo_datasets, getGEO, GSEMatrix = TRUE, simplify = FALSE, USE.NAMES = TRUE)
# Determine the number of dataset per series per GEO Accession.
sapply(lupus_nephritis_datasets, length)
# Pull single-element datasets.
single_element_data <- lupus_nephritis_datasets[lengths(lupus_nephritis_datasets) == 1]
for (i in 1:length(single_element_data)) {
names(single_element_data[[i]]) <- names(single_element_data[i])
list2env(single_element_data[[i]], .GlobalEnv)
}
View(single_element_data)
View(single_element_data$GSE136831$GSE136831@phenoData)
rm(i, single_element_data)
# Pull phenoData - sample metadata.
gse_pData <- pData(GSE157293)
# Pull phenoData - sample metadata.
gse_pData <- pData(GSE136831)
View(gse_pData)
knitr::opts_chunk$set(echo = TRUE)
library(GEOquery)
library(crayon)
library(tidyverse)
library(Seurat)
library(SeuratData)
library(Azimuth)
library(patchwork)
library(Matrix)
library(RCurl)
library(DoubletFinder)
library(scales)
library(SoupX)
library(cowplot)
library(metap)
library(SingleCellExperiment)
library(DropletUtils)
library(AnnotationHub)
library(HGNChelper)
library(ensembldb)
library(multtest)
library(glmGamPoi)
library(pbapply)
library(data.table)
library(ggrepel)
library(ggpubr)
library(stringr)
library(canvasXpress)
library(clinfun)
library(GGally)
library(factoextra)
library(DESeq2)
library(limma)
library(fgsea)
library(org.Mm.eg.db)
library(kableExtra)
# Specify path to raw data.
project_path = "~/Documents/Work/UnityHealth/Data_Projects/scRNAseq_LungFibrosisAnalysis/GSE136831/"
paste0(project_path, "GSE136831_RawCounts_Sparse.mtx.gz")
# Read in the sparse matrix, barcode and genes.
mat <- readMM(file = paste0(project_path, "GSE136831_RawCounts_Sparse.mtx.gz"))
# Read in the sparse matrix, barcode and genes.
mat <- readMM(file = paste0(project_path, "raw_data/GSE136831_RawCounts_Sparse.mtx.gz"))
