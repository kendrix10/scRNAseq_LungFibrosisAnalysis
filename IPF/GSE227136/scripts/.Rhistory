assays = "RNA",
group.by = c("cell_type", "Diagnosis", "Sample_Name"),
return.seurat = TRUE)
# Use the new metadata column as the default ident.
head(Cells(pseudo_seu))
# Create an aggregate variable with cell_type and condition.
pseudo_seu$deg_variable <- paste(pseudo_seu$cell_type, pseudo_seu$Diagnosis, sep = "_")
# Set deg_variable as the default ident.
Idents(pseudo_seu) <- "deg_variable"
# Connect to AnnotationHub.
ah <- AnnotationHub()
# Access the Ensembl database for organism.
ahDb <- query(ah,
pattern = c("Homo sapiens", "EnsDb"),
ignore.case = TRUE)
# Acquire the latest annotation files.
id <- ahDb %>%
mcols() %>%
rownames() %>%
tail(n = 1)
# Download the appropriate Ensembldb database.
edb <- ah[[id]]
# Extract gene-level information from database.
annotations <- genes(edb,
return.type = "data.frame")
# Select annotations of interest.
annotations <- annotations %>%
dplyr::select(gene_id, gene_name, seq_name, gene_biotype, description)
# Remove unneeded objects.
rm(ah, ahDb, edb, id)
# Find differential expression genes between IPF and control for fibroblasts.
# Positive logFC means ident.1 is upregulated relative to ident.2.
grep("Fibroblasts", Idents(pseudo_seu), value = TRUE) %>% unique()
fibroblasts_deg <- FindMarkers(pseudo_seu,
ident.1 = "Fibroblasts_IPF",
ident.2 = "Fibroblasts_Control",
test.use = "DESeq2")
# Add gene annotations to the DEG output.
fibroblasts_deg <- (fibroblasts_deg %>%
rownames_to_column("geneID") %>%
dplyr::left_join(., annotations, by = c("geneID" = "gene_name")))
# Volcano plot.
EnhancedVolcano(fibroblasts_deg,
fibroblasts_deg$geneID,
x = "avg_log2FC",
y = "p_val_adj",
selectLab = c(fibroblasts_deg[c(fibroblasts_deg$p_val_adj < 1e-5 &
(fibroblasts_deg$avg_log2FC > 1.25 |
fibroblasts_deg$avg_log2FC < -1.25)),]$geneID,
"ANTXR1"),
title = "Control Fibroblasts vs. IPF Fibroblasts",
pointSize = 1.0,
colAlpha = 0.8,
drawConnectors = TRUE,
legendPosition = "bottom",
legendLabSize = 12.0,
legendIconSize = 3.0)
# Explore DEG output.
datatable(
fibroblasts_deg %>%
arrange(p_val_adj, avg_log2FC),
caption = "Significantly expressed genes between Control and IPF Fibroblasts",
options = list(pageLength = 10, scrollX = TRUE),
rownames = FALSE
) %>%
formatRound(columns = c("avg_log2FC"), digits = 3) %>%
formatSignif(columns = c("p_val"), digits = 3) %>%
formatSignif(columns = c("p_val_adj"), digits = 3)
# Volcano plot.
EnhancedVolcano(fibroblasts_deg,
fibroblasts_deg$geneID,
x = "avg_log2FC",
y = "p_val_adj",
selectLab = c(,
"ANTXR1"),
title = "Control Fibroblasts vs. IPF Fibroblasts",
pointSize = 1.0,
colAlpha = 0.8,
drawConnectors = TRUE,
legendPosition = "bottom",
legendLabSize = 12.0,
legendIconSize = 3.0)
# Volcano plot.
EnhancedVolcano(fibroblasts_deg,
fibroblasts_deg$geneID,
x = "avg_log2FC",
y = "p_val_adj",
selectLab = c("ANTXR1"),
title = "Control Fibroblasts vs. IPF Fibroblasts",
pointSize = 1.0,
colAlpha = 0.8,
drawConnectors = TRUE,
legendPosition = "bottom",
legendLabSize = 12.0,
legendIconSize = 3.0)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\bY\b", "Yes", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\b Y \b", "Yes", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\b Y", "Yes", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Quickly clean up variables.
unique(metadata$Tobacco)
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw()
print(p)
}
unique(metadata$Gender)
metadata$Gender <- gsub("NA", "Unknown", metadata$Gender)
unique(metadata$Gender)
metadata$Gender <- gsub(NA, "Unknown", metadata$Gender)
unique(metadata$Gender)
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
unique(metadata$Gender)
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw()
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
theme_bw()
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
print(p)
}
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 0.5))
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 0.5))
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = -0.5))
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = -1, hjust = 0.5))
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5))
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 0.5))
print(p)
}
# Pull the sample metadata.
metadata <- Extract_Sample_Meta(obj,
sample_col = "Sample_Name",
variables_include = c("Diagnosis",
"Sample_Source",
"Sample_Type",
"Tobacco",
"Status",
"Gender",
"Age",
"Ethnicity"))
# Quickly clean up variables.
unique(metadata$Tobacco)
metadata$Tobacco <- gsub("\\bY\\b", "Yes", metadata$Tobacco)
metadata$Tobacco <- gsub("\\bN\\b", "No", metadata$Tobacco)
metadata$Tobacco <- gsub("Smoker", "smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 30 years ago", "Former smoker", metadata$Tobacco)
metadata$Tobacco <- gsub("Quit 1997", "Former smoker", metadata$Tobacco)
# Define columns to plot.
columns_incl <- colnames(metadata)
columns_incl <- columns_incl[columns_incl != "Sample_Name"]
# Loop through columns to plot and visualize.
for (col in columns_incl) {
p <- ggplot(metadata, aes_string(x = col)) +
geom_bar(fill = "darkslategrey", colour = "black") +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
labs(title = paste("Distribution of", col, "in GSE227136"),
x = col,
y = "Count") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
print(p)
}
