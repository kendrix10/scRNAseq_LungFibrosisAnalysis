angle = 0,
repel = TRUE) +
labs(x = "Timepoint",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 30) +
scale_colour_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 0,
hjust = 0.5,
vjust = 1))
# Visualize the expressions of all cell type clusters.
VlnPlot(seurat_obj,
features = c("Acta2", "Col1a2", "Col3a1", "Col1a1", "Antxr1"),
group.by = "cell_type",
split.by = "treatment",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1,
raster = FALSE) +
theme(legend.position = "top") +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Subset non-zero level expressing cell types
vln_seu <- subset(seurat_obj,
idents = c("AT1", "AT2", "Endothelial cells",
"Endothelial lymphatic",
"Fibroblasts", "Fibromyocytes"),
invert = FALSE)
# Get all the collagen genes.
grep("^Col{1}[0-9]+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
# Create a gene list of non-zero collagen genes.
col_genes = c("Col1a1", "Col1a2", "Col3a1", "Col4a1", "Col4a2",
"Col4a5", "Col5a1", "Col5a2", "Col6a1", "Col6a2",
"Col6a3", "Col13a1", "Col14a1", "Col16a1", "Col18a1",
"Col23a1")
# Visualize the expressions of all cell type clusters.
VlnPlot(vln_seu,
features = c("Acta2", col_genes, "Antxr1"),
group.by = "cell_type",
split.by = "timepoint",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 0, hjust = 0.5)) +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Subset non-zero level expressing cell types
vln_seu <- subset(seurat_obj,
idents = c("AT1", "AT2", "Fibroblasts"), invert = FALSE)
# Get all the TGFB & PDGF genes.
grep("^Tgfb+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
grep("^Pdgf+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
fibrosis_genes = c("Tgfb1", "Tgfb2", "Tgfb3", "Pdgfa", "Pdgfb", "Ctgf")
# Visualize the level of expressions of fibrosis genes in subsetted cell types.
VlnPlot(vln_seu,
features = fibrosis_genes,
group.by = "cell_type",
split.by = "timepoint",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 0, hjust = 0.5)) +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Visualize the degree of expression of fibrosis genes in subsetted cell types.
fibrosis_genes = c("Ctgf", "Pdgfb", "Pdgfa", "Tgfb3", "Tgfb2", "Tgfb1")
DotPlot(vln_seu,
features = fibrosis_genes) +
scale_color_gradient2(low = "#c85200", mid = "#cccccc", high = "#366785") +
coord_flip()
knitr::opts_chunk$set(echo = TRUE)
library(GEOquery)
library(crayon)
library(tidyverse)
library(Seurat)
library(SeuratData)
library(Azimuth)
library(patchwork)
library(Matrix)
library(RCurl)
library(DoubletFinder)
library(scales)
library(SoupX)
library(cowplot)
library(metap)
library(SingleCellExperiment)
library(DropletUtils)
library(AnnotationHub)
library(HGNChelper)
library(ensembldb)
library(multtest)
library(glmGamPoi)
library(pbapply)
library(data.table)
library(ggrepel)
library(ggpubr)
library(stringr)
library(canvasXpress)
library(clinfun)
library(GGally)
library(gridExtra)
library(factoextra)
library(DESeq2)
library(EnhancedVolcano)
library(ComplexHeatmap)
library(limma)
library(fgsea)
library(org.Mm.eg.db)
library(kableExtra)
# Specify project file path.
project_path = "~/Documents/Work/UnityHealth/Data_Projects/scRNAseq_LungFibrosisAnalysis/GSE264278/"
# Load pre-processed Seurat objects.
load(file = paste0(project_path, "data/preprocessed_seurat_obj.RData"))
# Set colour palette for cell type.
celltype_col = c("AT1" = "#2f4f4f",
"AT2" = "#00bfff",
"Basal resting" = "#2e8b57",
"Club (non-nasal)" = "#8b008b",
"Deuterosomal" = "#00ff00",
"Endothelial cells" = "#808000",
"Endothelial lympathic" = "#00008b",
"Fibroblasts" = "#ff4500",
"Fibromyocytes" = "#ffa500",
"Immune" = "#f08080",
"Ionocyte" = "#f0e68c",
"Multiciliated (non-nasal)" = "#ff00ff",
"Myofibroblasts" = "#c71585",
"Neuroendocrine" = "#00fa9a",
"Pericytes" = "#ff1493",
"Suprabasal" = "#eee8aa",
"Transitional Club-AT2" = "#9370db",
"VSMCs" = "#00ffff")
# Set new name for Seurat object to be more informative.
seurat_obj = seurat_cluster
# Collapse different types of endothelial cells into generic endothelial cells.
grep("Endothelial", seurat_obj$cell_type, value = TRUE) %>% unique()
seurat_obj$cell_type <- gsub("Endothelial venous|Endothelial capillary|Endothelial arterial",
"Endothelial cells",
seurat_obj$cell_type)
# Collapse fibroblasts and myofibroblasts into fibroblasts.
grep("ibroblast", seurat_obj$cell_type, value = TRUE) %>% unique()
seurat_obj$cell_type <- gsub("Myofibroblasts",
"Fibroblasts",
seurat_obj$cell_type)
# Set max overlaps to infinity globally.
options(ggrepel.max.overlaps = Inf)
# Factorize timepoint to arrange it in chronological order.
seurat_obj$timepoint <- factor(seurat_obj$timepoint, levels = c("Untreated",
"Day 3",
"Day 7",
"Day 14",
"Day 28",
"Day 42",
"Day 63"))
# Set Seurat object idents.
Idents(seurat_obj) <- "cell_type"
# Remove unneeded objects.
rm(seurat_cluster)
# Get the variables of interest.
summary_table <- (FetchData(seurat_obj,
vars = c("cell_type",
"orig.ident",
"replicate",
"treatment",
"treatment_dosage",
"timepoint",
"Antxr1",
"Krt8")))
# Each timepoint contains unsorted lung tissues from 5 mice.
# Define ANTXR1 expression based on 0 expression threshold.
summary_table <- summary_table %>% mutate(Antxr1_expressed = Antxr1 > 0)
# Define KRT8 expression based on 0 expression threshold.
summary_table <- summary_table %>% mutate(Krt8_expressed = Krt8 > 0)
# Calculate total cells per timepoint.
total_cells_timepoint_mice <- (summary_table %>%
group_by(orig.ident, timepoint) %>%
summarise(total_cells_timepoint = n(),
.groups = "drop"))
# Summarise cell counts per mice per timepoint for each cell type.
celltype_timepoint_counts_mice <- (summary_table %>%
group_by(orig.ident, cell_type, timepoint) %>%
summarise(celltype_count = n(),
Antxr1_total_exprs = sum(Antxr1_expressed),
Krt8_total_exprs = sum(Krt8_expressed),
.groups = "drop") %>%
left_join(total_cells_timepoint_mice,
by = c("orig.ident", "timepoint")))
# Calculate percentages.
celltype_timepoint_counts_mice <- (celltype_timepoint_counts_mice %>%
mutate(celltype_by_totalcells =
(celltype_count/total_cells_timepoint)*100,
Antxr1_by_totalcells =
(Antxr1_total_exprs/total_cells_timepoint)*100,
Antxr1_by_celltypes =
(Antxr1_total_exprs/celltype_count)*100,
Krt8_by_totalcells =
(Krt8_total_exprs/total_cells_timepoint)*100,
Krt8_by_celltypes =
(Krt8_total_exprs/celltype_count)*100))
# Calculate summary statistics for the calculated percentages by mice.
summary_stats <- (celltype_timepoint_counts_mice %>%
group_by(cell_type, timepoint) %>%
summarise(
mean_percent_celltype = mean(celltype_by_totalcells),
sd_percent_celltype = sd(celltype_by_totalcells),
mean_percent_antxr1_total = mean(Antxr1_by_totalcells),
sd_percent_antxr1_total = sd(Antxr1_by_totalcells),
mean_percent_antxr1_celltype = mean(Antxr1_by_celltypes),
sd_percent_antxr1_celltype = sd(Antxr1_by_celltypes),
mean_percent_krt8_total = mean(Krt8_by_totalcells),
sd_percent_krt8_total = sd(Krt8_by_totalcells),
mean_percent_krt8_celltype = mean(Krt8_by_celltypes),
sd_percent_krt8_celltype = sd(Krt8_by_celltypes),
n_mice = n(),
se_percent_celltype = sd_percent_celltype / sqrt(n_mice),
se_percent_antxr1_total = sd_percent_antxr1_total / sqrt(n_mice),
se_percent_antxr1_celltype = sd_percent_antxr1_celltype / sqrt(n_mice),
se_percent_krt8_total = sd_percent_krt8_total / sqrt(n_mice),
se_percent_krt8_celltype = sd_percent_krt8_celltype / sqrt(n_mice),
.groups = "drop"
))
# Remove unneeded objects.
rm(total_cells_timepoint_mice)
# Visualize the global cell proportion as a UMAP.
p1 <- DimPlot(seurat_obj,
reduction = "umap",
group.by = "cell_type",
split.by = "timepoint",
cols = celltype_col,
label = TRUE,
label.size = 3,
label.color = "#02066f",
repel = TRUE,
order = TRUE,
ncol = 2,
raster = FALSE) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 8),
axis.text.y = element_text(size = 8),
strip.text = element_text(size = 15)) +
NoLegend()
# Visualize cell proportion counts as barplot.
p2 <- celltype_timepoint_counts_mice %>%
group_by(cell_type, timepoint) %>%
summarise(n = n(),
mean = plyr::round_any(mean(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
sd = plyr::round_any(sd(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
.groups = "drop") %>%
mutate(se = plyr::round_any(sd/sqrt(n), accuracy = 0.01, f = ceiling)) %>%
ggplot(aes(x = cell_type,
y = mean,
fill = cell_type)) +
geom_col(show.legend = FALSE) +
geom_errorbar(aes(ymin = mean-se,
ymax = mean+se),
width = 0.4,
alpha = 0.9) +
geom_text(aes(label = mean,
vjust = 0.5,
hjust = -0.8),
size = 5,
angle = 90) +
facet_wrap(~timepoint, ncol = 2) +
labs(x = "Cell type",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 100) +
scale_fill_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 90,
hjust = 1,
vjust = 0.5),
strip.text = element_text(size = 15))
# Visualize both plots together.
grid.arrange(p1, p2, ncol = 1)
# Define list of cell types for each subgroups.
AT2 = WhichCells(seurat_obj, idents = c("AT2"))
fibroblasts = WhichCells(seurat_obj, idents = c("Fibroblasts"))
endothelial = WhichCells(seurat_obj, idents = c("Endothelial cells"))
VSMCs = WhichCells(seurat_obj, idents = c("VSMCs"))
# Visualize the global cell proportion as a UMAP.
p1 <- DimPlot(seurat_obj,
reduction = "umap",
group.by = "cell_type",
split.by = "timepoint",
cells.highlight = list(AT2,
fibroblasts,
endothelial,
VSMCs),
cols.highlight = c("#00ffff", "#808000", "#ff4500", "#00bfff"),
label = TRUE,
label.size = 3,
label.color = "#02066f",
repel = TRUE,
order = TRUE,
ncol = 2,
raster = FALSE) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 8),
axis.text.y = element_text(size = 8),
strip.text = element_text(size = 15)) +
NoLegend()
# Visualize cell proportion counts as barplot.
p2 <- celltype_timepoint_counts_mice %>%
dplyr::filter(cell_type %in% c("AT2",
"Fibroblasts",
"Endothelial cells",
"VSMCs")) %>%
group_by(cell_type, timepoint) %>%
summarise(n = n(),
mean = plyr::round_any(mean(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
sd = plyr::round_any(sd(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
.groups = "drop") %>%
mutate(se = plyr::round_any(sd/sqrt(n), accuracy = 0.01, f = ceiling)) %>%
ggplot(aes(x = cell_type,
y = mean,
fill = cell_type)) +
geom_col(show.legend = FALSE) +
geom_errorbar(aes(ymin = mean-se,
ymax = mean+se),
width = 0.4,
alpha = 0.9) +
geom_text(aes(label = mean,
vjust = 0.5,
hjust = -0.8),
size = 5,
angle = 90) +
facet_wrap(~timepoint, ncol = 2) +
labs(x = "Cell type",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 35) +
scale_fill_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 45,
hjust = 1,
vjust = 1),
strip.text = element_text(size = 15))
# Visualize both plots together.
grid.arrange(p1, p2, ncol = 1)
# Visualize cell proportion counts as line graph.
celltype_timepoint_counts_mice %>%
dplyr::filter(cell_type %in% c("AT2",
"Fibroblasts",
"Endothelial cells",
"VSMCs")) %>%
group_by(cell_type, timepoint) %>%
summarise(n = n(),
mean = plyr::round_any(mean(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
sd = plyr::round_any(sd(celltype_by_totalcells),
accuracy = 0.01,
f = ceiling),
.groups = "drop") %>%
mutate(se = plyr::round_any(sd/sqrt(n), accuracy = 0.01, f = ceiling)) %>%
ggplot(aes(x = timepoint,
y = mean,
group = cell_type,
colour = cell_type)) +
geom_line(size = 0.7) +
geom_point(size = 2) +
geom_errorbar(aes(ymin = mean-se,
ymax = mean+se),
width = 0.4,
alpha = 0.9) +
geom_text(aes(label = mean,
vjust = 0.5,
hjust = -0.8),
size = 5,
angle = 0,
repel = TRUE) +
labs(x = "Timepoint",
y = "% mean cell type for each timepoint
(Blank = > 0.001 or 0.1%)",
fill = element_blank()) +
ylim(0, 30) +
scale_colour_manual(values = celltype_col) +
theme_linedraw() +
theme(axis.text.x = element_text(size = 12,
angle = 0,
hjust = 0.5,
vjust = 1))
# Visualize the expressions of all cell type clusters.
VlnPlot(seurat_obj,
features = c("Acta2", "Col1a2", "Col3a1", "Col1a1", "Antxr1"),
group.by = "cell_type",
split.by = "treatment",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1,
raster = FALSE) +
theme(legend.position = "top") +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Subset non-zero level expressing cell types
vln_seu <- subset(seurat_obj,
idents = c("AT1", "AT2", "Fibroblasts"), invert = FALSE)
# Get all the collagen genes.
grep("^Col{1}[0-9]+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
# Create a gene list of non-zero collagen genes.
col_genes = c("Col1a1", "Col1a2", "Col3a1", "Col4a1", "Col4a2",
"Col4a5", "Col5a1", "Col5a2", "Col6a1", "Col6a2",
"Col6a3", "Col13a1", "Col14a1", "Col16a1", "Col18a1",
"Col23a1")
# Visualize the expressions of all cell type clusters.
VlnPlot(vln_seu,
features = c("Acta2", col_genes, "Antxr1"),
group.by = "cell_type",
split.by = "timepoint",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 0, hjust = 0.5)) +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
# Subset non-zero level expressing cell types
vln_seu <- subset(seurat_obj,
idents = c("AT1", "AT2", "Fibroblasts"),
timepoint = c("Untreated", "Day 7", "Day 42", "Day 63"),
invert = FALSE)
# Get all the TGFB & PDGF genes.
grep("^Tgfb+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
grep("^Pdgf+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
fibrosis_genes = c("Tgfb1", "Tgfb2", "Tgfb3", "Pdgfa", "Pdgfb", "Ctgf")
# Visualize the level of expressions of fibrosis genes in subsetted cell types.
VlnPlot(vln_seu,
features = fibrosis_genes,
group.by = "cell_type",
split.by = "timepoint",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 0, hjust = 0.5)) +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
unique(seurat_obj$timepoint)
# Subset non-zero level expressing cell types
vln_seu <- subset(seurat_obj,
idents = c("AT1", "AT2", "Fibroblasts"),
subset = timepoint %in% c("Untreated", "Day 7", "Day 42", "Day 63"),
invert = FALSE)
# Get all the TGFB & PDGF genes.
grep("^Tgfb+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
grep("^Pdgf+", rownames(vln_seu), value = TRUE) %>% unique() %>% sort()
fibrosis_genes = c("Tgfb1", "Tgfb2", "Tgfb3", "Pdgfa", "Pdgfb", "Ctgf")
# Visualize the level of expressions of fibrosis genes in subsetted cell types.
VlnPlot(vln_seu,
features = fibrosis_genes,
group.by = "cell_type",
split.by = "timepoint",
split.plot = FALSE,
stack = TRUE,
flip = TRUE,
same.y.lims = TRUE,
ncol = 1) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 0, hjust = 0.5)) +
stat_summary(fun.y = median,
geom = "point",
size = 1,
color = "#000001",
position = position_dodge(0.9))
